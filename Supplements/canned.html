<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml" lang="en" xml:lang="en"><head>

<meta charset="utf-8">
<meta name="generator" content="quarto-1.4.551">

<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=yes">

<meta name="author" content="Alejandro Morales">
<meta name="dcterms.date" content="2025-10-27">

<title>Practical Labs CSA-40306 Ecological Modelling and Data Analysis in R - Supplement: Formula-based methods</title>
<style>
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
div.columns{display: flex; gap: min(4vw, 1.5em);}
div.column{flex: auto; overflow-x: auto;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
ul.task-list li input[type="checkbox"] {
  width: 0.8em;
  margin: 0 0.8em 0.2em -1em; /* quarto-specific, see https://github.com/quarto-dev/quarto-cli/issues/4556 */ 
  vertical-align: middle;
}
/* CSS for syntax highlighting */
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
  }
pre.numberSource { margin-left: 3em;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
</style>


<script src="../site_libs/quarto-nav/quarto-nav.js"></script>
<script src="../site_libs/quarto-nav/headroom.min.js"></script>
<script src="../site_libs/clipboard/clipboard.min.js"></script>
<script src="../site_libs/quarto-search/autocomplete.umd.js"></script>
<script src="../site_libs/quarto-search/fuse.min.js"></script>
<script src="../site_libs/quarto-search/quarto-search.js"></script>
<meta name="quarto:offset" content="../">
<script src="../site_libs/quarto-html/quarto.js"></script>
<script src="../site_libs/quarto-html/popper.min.js"></script>
<script src="../site_libs/quarto-html/tippy.umd.min.js"></script>
<script src="../site_libs/quarto-html/anchor.min.js"></script>
<link href="../site_libs/quarto-html/tippy.css" rel="stylesheet">
<link href="../site_libs/quarto-html/quarto-syntax-highlighting.css" rel="stylesheet" id="quarto-text-highlighting-styles">
<script src="../site_libs/bootstrap/bootstrap.min.js"></script>
<link href="../site_libs/bootstrap/bootstrap-icons.css" rel="stylesheet">
<link href="../site_libs/bootstrap/bootstrap.min.css" rel="stylesheet" id="quarto-bootstrap" data-mode="light">
<script id="quarto-search-options" type="application/json">{
  "location": "sidebar",
  "copy-button": false,
  "collapse-after": 3,
  "panel-placement": "start",
  "type": "textbox",
  "limit": 50,
  "keyboard-shortcut": [
    "f",
    "/",
    "s"
  ],
  "show-item-context": false,
  "language": {
    "search-no-results-text": "No results",
    "search-matching-documents-text": "matching documents",
    "search-copy-link-title": "Copy link to search",
    "search-hide-matches-text": "Hide additional matches",
    "search-more-match-text": "more match in this document",
    "search-more-matches-text": "more matches in this document",
    "search-clear-button-title": "Clear",
    "search-text-placeholder": "",
    "search-detached-cancel-button-title": "Cancel",
    "search-submit-button-title": "Submit",
    "search-label": "Search"
  }
}</script>


<link rel="stylesheet" href="styles.css">
</head>

<body class="nav-sidebar docked">

<div id="quarto-search-results"></div>
  <header id="quarto-header" class="headroom fixed-top">
  <nav class="quarto-secondary-nav">
    <div class="container-fluid d-flex">
      <button type="button" class="quarto-btn-toggle btn" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">
        <i class="bi bi-layout-text-sidebar-reverse"></i>
      </button>
        <nav class="quarto-page-breadcrumbs" aria-label="breadcrumb"><ol class="breadcrumb"><li class="breadcrumb-item"><a href="../Supplements/canned.html">Supplement: Canned methods</a></li></ol></nav>
        <a class="flex-grow-1" role="button" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item" aria-controls="quarto-sidebar" aria-expanded="false" aria-label="Toggle sidebar navigation" onclick="if (window.quartoToggleHeadroom) { window.quartoToggleHeadroom(); }">      
        </a>
      <button type="button" class="btn quarto-search-button" aria-label="" onclick="window.quartoOpenSearch();">
        <i class="bi bi-search"></i>
      </button>
    </div>
  </nav>
</header>
<!-- content -->
<div id="quarto-content" class="quarto-container page-columns page-rows-contents page-layout-article">
<!-- sidebar -->
  <nav id="quarto-sidebar" class="sidebar collapse collapse-horizontal quarto-sidebar-collapse-item sidebar-navigation docked overflow-auto">
    <div class="pt-lg-2 mt-2 text-left sidebar-header">
    <div class="sidebar-title mb-0 py-0">
      <a href="../">Practical Labs CSA-40306 Ecological Modelling and Data Analysis in R</a> 
        <div class="sidebar-tools-main">
  <a href="" class="quarto-reader-toggle quarto-navigation-tool px-1" onclick="window.quartoToggleReader(); return false;" title="Toggle reader mode">
  <div class="quarto-reader-toggle-btn">
  <i class="bi"></i>
  </div>
</a>
</div>
    </div>
      </div>
        <div class="mt-2 flex-shrink-0 align-items-center">
        <div class="sidebar-search">
        <div id="quarto-search" class="" title="Search"></div>
        </div>
        </div>
    <div class="sidebar-menu-container"> 
    <ul class="list-unstyled mt-1">
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab1/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab2/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab3/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab4/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab6/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5 &amp; 6</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab7/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab9/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 9</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab10/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 10</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Supplements/optim.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supplement: mle2 vs optim</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Supplements/canned.html" class="sidebar-item-text sidebar-link active">
 <span class="menu-text">Supplement: Canned methods</span></a>
  </div>
</li>
        <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Supplements/bias_variance/no_solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Supplement: Variance and bias of estimates</span></a>
  </div>
</li>
        <li class="sidebar-item sidebar-item-section">
      <div class="sidebar-item-container"> 
            <a class="sidebar-item-text sidebar-link text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false">
 <span class="menu-text">Solutions</span></a>
          <a class="sidebar-item-toggle text-start collapsed" data-bs-toggle="collapse" data-bs-target="#quarto-sidebar-section-1" aria-expanded="false" aria-label="Toggle section">
            <i class="bi bi-chevron-right ms-2"></i>
          </a> 
      </div>
      <ul id="quarto-sidebar-section-1" class="collapse list-unstyled sidebar-section depth1 ">  
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab1/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 1 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab2/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 2 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab3/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 3 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab4/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 4 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab6/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 5 &amp; 6 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab7/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 7 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab9/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 9 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Lab10/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Lab 10 (solutions)</span></a>
  </div>
</li>
          <li class="sidebar-item">
  <div class="sidebar-item-container"> 
  <a href="../Supplements/bias_variance/solution.html" class="sidebar-item-text sidebar-link">
 <span class="menu-text">Variance and bias of estimates (solutions)</span></a>
  </div>
</li>
      </ul>
  </li>
    </ul>
    </div>
</nav>
<div id="quarto-sidebar-glass" class="quarto-sidebar-collapse-item" data-bs-toggle="collapse" data-bs-target=".quarto-sidebar-collapse-item"></div>
<!-- margin-sidebar -->
    <div id="quarto-margin-sidebar" class="sidebar margin-sidebar">
        <nav id="TOC" role="doc-toc" class="toc-active">
    <h2 id="toc-title">On this page</h2>
   
  <ul>
  <li><a href="#introduction" id="toc-introduction" class="nav-link active" data-scroll-target="#introduction"><span class="header-section-number">1</span> Introduction</a></li>
  <li><a href="#the-formula-interface" id="toc-the-formula-interface" class="nav-link" data-scroll-target="#the-formula-interface"><span class="header-section-number">2</span> The <em>formula</em> interface</a></li>
  <li><a href="#linear-responses" id="toc-linear-responses" class="nav-link" data-scroll-target="#linear-responses"><span class="header-section-number">3</span> Linear responses</a>
  <ul class="collapse">
  <li><a href="#linear-model" id="toc-linear-model" class="nav-link" data-scroll-target="#linear-model"><span class="header-section-number">3.1</span> Linear model</a></li>
  <li><a href="#generalized-least-squares" id="toc-generalized-least-squares" class="nav-link" data-scroll-target="#generalized-least-squares"><span class="header-section-number">3.2</span> Generalized least squares</a></li>
  <li><a href="#linear-mixed-model" id="toc-linear-mixed-model" class="nav-link" data-scroll-target="#linear-mixed-model"><span class="header-section-number">3.3</span> Linear mixed model</a></li>
  </ul></li>
  <li><a href="#generalized-linear-responses" id="toc-generalized-linear-responses" class="nav-link" data-scroll-target="#generalized-linear-responses"><span class="header-section-number">4</span> Generalized linear responses</a>
  <ul class="collapse">
  <li><a href="#generalized-linear-models" id="toc-generalized-linear-models" class="nav-link" data-scroll-target="#generalized-linear-models"><span class="header-section-number">4.1</span> Generalized linear models</a></li>
  <li><a href="#generalized-linear-mixed-models" id="toc-generalized-linear-mixed-models" class="nav-link" data-scroll-target="#generalized-linear-mixed-models"><span class="header-section-number">4.2</span> Generalized linear mixed models</a></li>
  </ul></li>
  <li><a href="#non-linear-responses" id="toc-non-linear-responses" class="nav-link" data-scroll-target="#non-linear-responses"><span class="header-section-number">5</span> Non-linear responses</a>
  <ul class="collapse">
  <li><a href="#on-self-starting-functions" id="toc-on-self-starting-functions" class="nav-link" data-scroll-target="#on-self-starting-functions"><span class="header-section-number">5.1</span> On self-starting functions</a></li>
  <li><a href="#non-linear-normal-responses" id="toc-non-linear-normal-responses" class="nav-link" data-scroll-target="#non-linear-normal-responses"><span class="header-section-number">5.2</span> Non-linear Normal responses</a>
  <ul class="collapse">
  <li><a href="#non-linear-model" id="toc-non-linear-model" class="nav-link" data-scroll-target="#non-linear-model"><span class="header-section-number">5.2.1</span> Non-linear model</a></li>
  <li><a href="#non-linear-mixed-models" id="toc-non-linear-mixed-models" class="nav-link" data-scroll-target="#non-linear-mixed-models"><span class="header-section-number">5.2.2</span> Non-linear mixed models</a></li>
  </ul></li>
  <li><a href="#non-linear-non-normal-responses" id="toc-non-linear-non-normal-responses" class="nav-link" data-scroll-target="#non-linear-non-normal-responses"><span class="header-section-number">5.3</span> Non-linear non-Normal responses</a>
  <ul class="collapse">
  <li><a href="#non-linear-non-normal-model" id="toc-non-linear-non-normal-model" class="nav-link" data-scroll-target="#non-linear-non-normal-model"><span class="header-section-number">5.3.1</span> Non-linear non-Normal model</a></li>
  <li><a href="#non-linear-non-normal-mixed-model" id="toc-non-linear-non-normal-mixed-model" class="nav-link" data-scroll-target="#non-linear-non-normal-mixed-model"><span class="header-section-number">5.3.2</span> Non-linear non-Normal mixed model</a></li>
  </ul></li>
  </ul></li>
  </ul>
</nav>
    </div>
<!-- main -->
<main class="content" id="quarto-document-content">

<header id="title-block-header" class="quarto-title-block default">
<div class="quarto-title">
<h1 class="title">Supplement: Formula-based methods</h1>
</div>



<div class="quarto-title-meta">

    <div>
    <div class="quarto-title-meta-heading">Author</div>
    <div class="quarto-title-meta-contents">
             <p>Alejandro Morales </p>
          </div>
  </div>
    
    <div>
    <div class="quarto-title-meta-heading">Published</div>
    <div class="quarto-title-meta-contents">
      <p class="date">October 27, 2025</p>
    </div>
  </div>
  
    
  </div>
  


</header>


<section id="introduction" class="level1" data-number="1">
<h1 data-number="1"><span class="header-section-number">1</span> Introduction</h1>
<p>Here I exemplify several typical statistical models with an example of each. For each type of model I provide:</p>
<ol type="1">
<li>Mathematical description</li>
<li>Function implementing negative log likelihood</li>
<li>Canned method that relies on <em>formula</em></li>
</ol>
<p>There are functions that allow specifying different types of models with formulae and exist for both Maximum Likelihood and Bayesian methods. In the case of maximum likelihood methods, they often implement methods of estimation that are specialized to a given class of model and are therefore more efficient than using non-linear optimization.</p>
<p>The formulae that are used to specify models can be slightly different for each package, but there are some common elements that are useful to know and I described in the section below. For possible extensions, read the documentation of each individual package or function.</p>
<p>I list different possible options below, for each type of model, starting with the simplest (linear models) up to the most general (non-linear mixed models with non-Normal responses).</p>
</section>
<section id="the-formula-interface" class="level1" data-number="2">
<h1 data-number="2"><span class="header-section-number">2</span> The <em>formula</em> interface</h1>
<p><em>Work in progress</em></p>
</section>
<section id="linear-responses" class="level1" data-number="3">
<h1 data-number="3"><span class="header-section-number">3</span> Linear responses</h1>
<p>Models with linear are those where parameters are linear with respect to the response variables. This does not mean that the response is linear, it can also be a polynomial (by taking powers of covariates) but the coefficients are always linear with respect to the response variables. Historically the analysis of linear models has split into two approaches:</p>
<ul>
<li><p>Linear regression: When predictors are continuous, focuses on estimating parameter values.</p></li>
<li><p>Analysis of variance: When predictors are discrete, focuses on comparing nested models via F-test.</p></li>
</ul>
<p>And there were several sub-types such as multiple linear regression, analysis of covariance (with both discrete and continuous predictors), etc. In the examples below I only show how to estimate parameters of linear models.</p>
<section id="linear-model" class="level2" data-number="3.1">
<h2 data-number="3.1" class="anchored" data-anchor-id="linear-model"><span class="header-section-number">3.1</span> Linear model</h2>
<p>Stochastic model: A single level assumed Normal. Mean response: Linear function of covariates. Variance response: Assumed constant.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>Base</code></td>
<td><code>lm</code></td>
</tr>
<tr class="even">
<td>Likelihood</td>
<td><code>bbmle</code></td>
<td><code>lme2</code></td>
</tr>
<tr class="odd">
<td>Both</td>
<td><code>glmmTMB</code></td>
<td><code>glmmTMB</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>rstanarm</code></td>
<td><code>stan_lm</code></td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td><code>brms</code></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><strong>Example withe categorical predictor</strong></p>
<p>A linear model with a categorical predictor with 3 levels.</p>
<p>Data simulation:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb1-2"><a href="#cb1-2" aria-hidden="true" tabindex="-1"></a>sd  <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb1-3"><a href="#cb1-3" aria-hidden="true" tabindex="-1"></a>mu0 <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb1-4"><a href="#cb1-4" aria-hidden="true" tabindex="-1"></a>deltas <span class="ot">=</span> <span class="fu">c</span>(<span class="dv">4</span>, <span class="fl">1.5</span>)</span>
<span id="cb1-5"><a href="#cb1-5" aria-hidden="true" tabindex="-1"></a>mus <span class="ot">=</span> <span class="fu">c</span>(mu0, mu0 <span class="sc">+</span> deltas)</span>
<span id="cb1-6"><a href="#cb1-6" aria-hidden="true" tabindex="-1"></a>n   <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb1-7"><a href="#cb1-7" aria-hidden="true" tabindex="-1"></a>groups <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span>L<span class="sc">:</span><span class="dv">3</span>L, <span class="at">each =</span> n)</span>
<span id="cb1-8"><a href="#cb1-8" aria-hidden="true" tabindex="-1"></a>y   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">3</span><span class="sc">*</span>n, <span class="fu">rep</span>(mus, <span class="at">each =</span> n), <span class="at">sd =</span> sd)</span>
<span id="cb1-9"><a href="#cb1-9" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">groups =</span> groups, <span class="at">fgroups =</span> <span class="fu">as.factor</span>(groups))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Explicit maximum likelihood:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a>NLL <span class="ot">=</span> <span class="cf">function</span>(mu0, delta1, delta2, lsd, groups, y) {</span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  mus <span class="ot">=</span> <span class="fu">c</span>(mu0, mu0 <span class="sc">+</span> delta1, mu0 <span class="sc">+</span> delta2)[groups]</span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(y, <span class="at">mean =</span> mus, <span class="at">sd =</span> <span class="fu">exp</span>(lsd), <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>}</span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a><span class="fu">mle2</span>(<span class="at">minuslogl =</span> NLL, <span class="at">start =</span> <span class="fu">list</span>(<span class="at">mu0 =</span> <span class="dv">1</span>, <span class="at">delta1 =</span> <span class="dv">0</span>, <span class="at">delta2 =</span> <span class="dv">0</span>, <span class="at">lsd =</span> <span class="fu">log</span>(<span class="dv">1</span>)),</span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>     <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>lm</code>:</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>mle2</code>:</p>
<div class="sourceCode" id="cb4"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mle2</span>(y<span class="sc">~</span><span class="fu">dnorm</span>(<span class="at">mean =</span> mu, <span class="at">sd =</span> <span class="fu">exp</span>(lsd)), <span class="at">parameters =</span> <span class="fu">list</span>(mu <span class="sc">~</span> fgroups),</span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">1</span>, <span class="at">lsd =</span> <span class="fu">log</span>(<span class="dv">1</span>)), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>glmmTMB</code>:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glmmTMB</span>(y<span class="sc">~</span>fgroups, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>rstanarm</code>:</p>
<div class="sourceCode" id="cb6"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stan_lm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data, <span class="at">prior =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>brm</code></p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Example with continuous predictor</strong></p>
<p>A simple linear regression.</p>
<p>Data simulation:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>a   <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>b   <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>sd  <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>n   <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>x   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>y   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, a <span class="sc">+</span> b<span class="sc">*</span>x, <span class="at">sd =</span> sd)</span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Negative log-likelihood:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a>NLL <span class="ot">=</span> <span class="cf">function</span>(mu1, mu2, mu3, sd, groups, y) {</span>
<span id="cb9-2"><a href="#cb9-2" aria-hidden="true" tabindex="-1"></a>  mus <span class="ot">=</span> <span class="fu">c</span>(mu1, mu2, mu3)[groups]</span>
<span id="cb9-3"><a href="#cb9-3" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(y, <span class="at">mean =</span> mus, <span class="at">sd =</span> sd, <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb9-4"><a href="#cb9-4" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>lm</code>:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="fu">lm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>mle2</code>:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(bbmle)</span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a><span class="fu">mle2</span>(y<span class="sc">~</span><span class="fu">dnorm</span>(<span class="at">mean =</span> mu, <span class="at">sd =</span> sd), <span class="at">parameters =</span> <span class="fu">list</span>(mu <span class="sc">~</span> fgroups),</span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a>           <span class="at">start =</span> <span class="fu">list</span>(<span class="at">mu =</span> <span class="dv">3</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>glmmTMB</code>:</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(glmmTMB)</span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a><span class="fu">glmmTMB</span>(y<span class="sc">~</span>fgroups, <span class="at">family =</span> <span class="fu">gaussian</span>(), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>rstanarm</code>:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(rstanarm)</span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a><span class="fu">stan_lm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data, <span class="at">prior =</span> <span class="cn">NULL</span>)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>brm</code></p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="fu">library</span>(brms)</span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(y<span class="sc">~</span>fgroups, <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generalized-least-squares" class="level2" data-number="3.2">
<h2 data-number="3.2" class="anchored" data-anchor-id="generalized-least-squares"><span class="header-section-number">3.2</span> Generalized least squares</h2>
<p>Stochastic model: A single level assumed Normal. Mean response: Linear function of covariates. Variance response: Non-linear function of covariates and/or correlation structure.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>nlme</code></td>
<td><code>gls</code></td>
</tr>
<tr class="even">
<td>Likelihood</td>
<td><code>bbmme</code></td>
<td><code>mle2</code></td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td><code>brms</code></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><strong>Examples</strong></p>
<p>A linear model with variance increasing exponentially with covariate.</p>
<p>Data simulation:</p>
<div class="sourceCode" id="cb15"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a>a   <span class="ot">=</span> <span class="dv">0</span></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a>b   <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb15-4"><a href="#cb15-4" aria-hidden="true" tabindex="-1"></a>c   <span class="ot">=</span> <span class="fl">0.05</span></span>
<span id="cb15-5"><a href="#cb15-5" aria-hidden="true" tabindex="-1"></a>n   <span class="ot">=</span> <span class="dv">5</span></span>
<span id="cb15-6"><a href="#cb15-6" aria-hidden="true" tabindex="-1"></a>x   <span class="ot">=</span> <span class="fu">rep</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">10</span>, <span class="at">each =</span> <span class="dv">5</span>)</span>
<span id="cb15-7"><a href="#cb15-7" aria-hidden="true" tabindex="-1"></a>y   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">50</span>, a <span class="sc">+</span> b<span class="sc">*</span>x, <span class="at">sd =</span> <span class="fu">sqrt</span>(<span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>c<span class="sc">*</span>x)))</span>
<span id="cb15-8"><a href="#cb15-8" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Negative log-likelihood:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a>NLL <span class="ot">=</span> <span class="cf">function</span>(a, b, c, x, y) {</span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a>  mus <span class="ot">=</span> a <span class="sc">+</span> b<span class="sc">*</span>x</span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a>  sd  <span class="ot">=</span> <span class="fu">sqrt</span>(<span class="fu">exp</span>(<span class="dv">2</span><span class="sc">*</span>c<span class="sc">*</span>x))</span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="sc">-</span><span class="fu">sum</span>(<span class="fu">dnorm</span>(y, <span class="at">mean =</span> mus, <span class="at">sd =</span> sd, <span class="at">log =</span> <span class="cn">TRUE</span>))</span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>}</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>gls</code>:</p>
<div class="sourceCode" id="cb17"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">gls</span>(y<span class="sc">~</span>x, <span class="at">weights =</span> <span class="fu">varExp</span>(<span class="at">form =</span> <span class="sc">~</span>x), <span class="at">data =</span> data, <span class="at">method =</span> <span class="st">"ML"</span>))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>mle2</code>:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>brm</code>:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="fu">brm</span>(<span class="fu">bf</span>(y<span class="sc">~</span>x, sigma<span class="sc">~</span><span class="fu">exp</span>(x)), <span class="at">data =</span> data, <span class="at">family =</span> <span class="fu">gaussian</span>())</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>Notes: The function <code>gls</code> allows only specific functions</p>
</section>
<section id="linear-mixed-model" class="level2" data-number="3.3">
<h2 data-number="3.3" class="anchored" data-anchor-id="linear-mixed-model"><span class="header-section-number">3.3</span> Linear mixed model</h2>
<p>Stochastic model: Multiple levels assumed Normal. Mean response: Linear function of covariates. Variance response: Non-linear function of covariates and/or correlation structure.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>nlme</code></td>
<td><code>lme</code></td>
</tr>
<tr class="even">
<td>Likelihood</td>
<td><code>lme4</code></td>
<td><code>lmer</code></td>
</tr>
<tr class="odd">
<td>Both</td>
<td><code>glmmTMB</code></td>
<td><code>glmmTMB</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>stanarm</code></td>
<td><code>stan_lmer</code></td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td><code>brms</code></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p>Note that <code>lmer</code> and <code>stan_lmer</code> allow for some correlation structure in residuals but do not allow modelling the variance itself. For that you need to use <code>lme</code> or <code>brm</code>.</p>
<p><strong>Examples</strong></p>
</section>
</section>
<section id="generalized-linear-responses" class="level1" data-number="4">
<h1 data-number="4"><span class="header-section-number">4</span> Generalized linear responses</h1>
<p>Models where the response variable is assumed different from Normal. The mean is modeled by a non-linear function (link) and a linear model of covariates. In other words, these models are non-linear but the parameters reported are linear with respect to a transformation of the mean.</p>
<p>Canned methods generally support a number of pre-specified distributions and link functions. For more diversity you will have to write you own model.</p>
<section id="generalized-linear-models" class="level2" data-number="4.1">
<h2 data-number="4.1" class="anchored" data-anchor-id="generalized-linear-models"><span class="header-section-number">4.1</span> Generalized linear models</h2>
<p>Stochastic model: A single level of one of the pre-specified distributions. Mean response: Linear function of covariates after link transformation. Variance response: Scale parameter (if present) assumed constant (but see note).</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>Base</code></td>
<td><code>glm</code></td>
</tr>
<tr class="even">
<td>Both</td>
<td><code>glmmTMB</code><sup>1</sup></td>
<td><code>glmmTMB</code></td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td><code>stanarm</code></td>
<td><code>stan_glm</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>brms</code><sup>1,2</sup></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> Correlation structure for residuals <sup>2</sup> Scale parameter can be modeled as non-linear function of covariates.</p>
<p><strong>Example</strong></p>
<p>An Poisson model with an log link function</p>
<p>With <code>glm</code></p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">glm</span>(y<span class="sc">~</span>x, <span class="at">family =</span> <span class="fu">poisson</span>(<span class="at">link =</span> <span class="st">"log"</span>), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="generalized-linear-mixed-models" class="level2" data-number="4.2">
<h2 data-number="4.2" class="anchored" data-anchor-id="generalized-linear-mixed-models"><span class="header-section-number">4.2</span> Generalized linear mixed models</h2>
<p>Stochastic model: Multiple levels. The latent ones must be Normal. Mean response: Linear function of covariates after link transformation. Variance response: In some cases in can be modeled as a function of covariates.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>lme4</code></td>
<td><code>glmer</code></td>
</tr>
<tr class="even">
<td>Both</td>
<td><code>glmmTMB</code><sup>1</sup></td>
<td><code>glmmTMB</code></td>
</tr>
<tr class="odd">
<td>Bayesian</td>
<td><code>stanarm</code></td>
<td><code>stan_glmer</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>brms</code><sup>1,2</sup></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> Correlation structure for residuals <sup>2</sup> Scale parameter can be modeled as non-linear function of covariates.</p>
</section>
</section>
<section id="non-linear-responses" class="level1" data-number="5">
<h1 data-number="5"><span class="header-section-number">5</span> Non-linear responses</h1>
<p>Models where the mean is modeled by a non-linear function of covariates.</p>
<p>Canned only support non-linear models that can be expressed as a formula so they must be quite simple. In Likelihood versions, it is important to choose good initial values as otherwise the algorithms will not converge. For that reason it is common to use self-starting functions that already specify a model and an internal algorithm to come up with good starting values (these are compatible with <code>nls</code> and <code>gnls</code>.</p>
<section id="on-self-starting-functions" class="level2" data-number="5.1">
<h2 data-number="5.1" class="anchored" data-anchor-id="on-self-starting-functions"><span class="header-section-number">5.1</span> On self-starting functions</h2>
<p>For non-linear models it is very important to have good initial estimates of parameters. R has the concept of <em>self-starting</em> models. A self-starting model implements a particular model and a procedure to “eye-ball” the initial values:</p>
<ul>
<li><p>Base R provides <code>SSasymp</code>, <code>SSasympOff</code>, <code>SSasympOrig</code>, <code>SSbiexp</code>, <code>SSfol</code>, <code>SSfpl</code>, <code>SSgompertz</code>, <code>SSlogis</code>, <code>SSmicmen</code>, <code>SSweibull</code></p></li>
<li><p>The package <code>nlraa</code> provides 28 new self-starting functions that are used in agricultural research but could be useful in more general ecological applications.</p></li>
<li><p>The package <code>vega</code> provides 4 new self-starting functions to model the relationship between species richness and area</p></li>
</ul>
<p>See this blog post on how to write your own self-starting functions: https://www.statforbiology.com/2020/stat_nls_selfstarting/</p>
</section>
<section id="non-linear-normal-responses" class="level2" data-number="5.2">
<h2 data-number="5.2" class="anchored" data-anchor-id="non-linear-normal-responses"><span class="header-section-number">5.2</span> Non-linear Normal responses</h2>
<section id="non-linear-model" class="level3" data-number="5.2.1">
<h3 data-number="5.2.1" class="anchored" data-anchor-id="non-linear-model"><span class="header-section-number">5.2.1</span> Non-linear model</h3>
<p>Stochastic model: A single level, assumed Normal. Mean response: Non-linear function of covariates. Variance response: Assumed constant (but see note).</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>Base</code></td>
<td><code>nls</code></td>
</tr>
<tr class="even">
<td>Likelihood</td>
<td><code>nlme</code><sup>1,2</sup></td>
<td><code>gnls</code></td>
</tr>
<tr class="odd">
<td>Likelihood</td>
<td><code>bbmle</code><sup>2</sup></td>
<td><code>mle2</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>brms</code><sup>1,2</sup></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> Correlation structure for residuals <sup>2</sup> Variance can be modeled as a non-linear function of covariates.</p>
<p><strong>Example with constant variance</strong></p>
<p>A Michaelis-Menten model:</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">1234</span>)</span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a>sd  <span class="ot">=</span> <span class="dv">1</span></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a>a   <span class="ot">=</span> <span class="dv">10</span></span>
<span id="cb21-4"><a href="#cb21-4" aria-hidden="true" tabindex="-1"></a>b   <span class="ot">=</span> <span class="dv">3</span></span>
<span id="cb21-5"><a href="#cb21-5" aria-hidden="true" tabindex="-1"></a>x   <span class="ot">=</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">10</span></span>
<span id="cb21-6"><a href="#cb21-6" aria-hidden="true" tabindex="-1"></a>y   <span class="ot">=</span> <span class="fu">rnorm</span>(<span class="dv">10</span>, <span class="at">mean =</span> a<span class="sc">*</span>x<span class="sc">/</span>(b <span class="sc">+</span> x), <span class="at">sd =</span> sd)</span>
<span id="cb21-7"><a href="#cb21-7" aria-hidden="true" tabindex="-1"></a>data <span class="ot">=</span> <span class="fu">data.frame</span>(<span class="at">y =</span> y, <span class="at">x =</span> x)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>nls</code></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">nls</span>(y<span class="sc">~</span>a<span class="sc">*</span>x<span class="sc">/</span>(b <span class="sc">+</span> x), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">2</span>), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>mle2</code></p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">mle2</span>(y<span class="sc">~</span><span class="fu">dnorm</span>(<span class="at">mean =</span> a<span class="sc">*</span>x<span class="sc">/</span>(b <span class="sc">+</span> x), <span class="at">sd =</span> sd), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">2</span>, <span class="at">sd =</span> <span class="dv">1</span>), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p>With <code>brm</code></p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="fu">summary</span>(<span class="fu">brm</span>(y<span class="sc">~</span>a<span class="sc">*</span>x<span class="sc">/</span>(b <span class="sc">+</span> x), <span class="at">data =</span> data))</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
<p><strong>Example with increasing variance</strong></p>
<p>A Michaelis-Menten model with error increasing exponential with predictor</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r code-with-copy"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">gnls</span>(y<span class="sc">~</span>a<span class="sc">*</span>x<span class="sc">/</span>(b <span class="sc">+</span> x), <span class="at">start =</span> <span class="fu">list</span>(<span class="at">a =</span> <span class="dv">5</span>, <span class="at">b =</span> <span class="dv">2</span>), </span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a>             <span class="at">weights =</span> <span class="fu">varExp</span>(<span class="at">form =</span> <span class="sc">~</span>x), <span class="at">data =</span> data)</span></code><button title="Copy to Clipboard" class="code-copy-button"><i class="bi"></i></button></pre></div>
</section>
<section id="non-linear-mixed-models" class="level3" data-number="5.2.2">
<h3 data-number="5.2.2" class="anchored" data-anchor-id="non-linear-mixed-models"><span class="header-section-number">5.2.2</span> Non-linear mixed models</h3>
<p>Stochastic model: Multiple levels assumed Normal. Mean response: Linear function of covariates after link transformation. Variance response: Correlation structure for residuals and variance can be modeled as non-linear function of covariates.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>nlme</code></td>
<td><code>nlme</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>brms</code></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
</section>
</section>
<section id="non-linear-non-normal-responses" class="level2" data-number="5.3">
<h2 data-number="5.3" class="anchored" data-anchor-id="non-linear-non-normal-responses"><span class="header-section-number">5.3</span> Non-linear non-Normal responses</h2>
<section id="non-linear-non-normal-model" class="level3" data-number="5.3.1">
<h3 data-number="5.3.1" class="anchored" data-anchor-id="non-linear-non-normal-model"><span class="header-section-number">5.3.1</span> Non-linear non-Normal model</h3>
<p>Stochastic model: A single level of one of the pre-specified distributions. Mean response: Non-linear function of covariates. Variance response: Variance can be modeled as non-linear function of covariates.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Likelihood</td>
<td><code>bbmle</code></td>
<td><code>mle2</code></td>
</tr>
<tr class="even">
<td>Bayesian</td>
<td><code>brms</code><sup>1</sup></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>
<p><sup>1</sup> Also allows correlation structures</p>
</section>
<section id="non-linear-non-normal-mixed-model" class="level3" data-number="5.3.2">
<h3 data-number="5.3.2" class="anchored" data-anchor-id="non-linear-non-normal-mixed-model"><span class="header-section-number">5.3.2</span> Non-linear non-Normal mixed model</h3>
<p>Stochastic model: Multiple levels. The latent ones must be Normal. Mean response: Non-linear function of covariates. Variance response: Correlation structure for residuals and variance can be modeled as non-linear function of covariates.</p>
<table class="table">
<thead>
<tr class="header">
<th>Paradigm</th>
<th>Package</th>
<th>Function</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>Bayesian</td>
<td><code>brms</code></td>
<td><code>brm</code></td>
</tr>
</tbody>
</table>


</section>
</section>
</section>

</main> <!-- /main -->
<script id="quarto-html-after-body" type="application/javascript">
window.document.addEventListener("DOMContentLoaded", function (event) {
  const toggleBodyColorMode = (bsSheetEl) => {
    const mode = bsSheetEl.getAttribute("data-mode");
    const bodyEl = window.document.querySelector("body");
    if (mode === "dark") {
      bodyEl.classList.add("quarto-dark");
      bodyEl.classList.remove("quarto-light");
    } else {
      bodyEl.classList.add("quarto-light");
      bodyEl.classList.remove("quarto-dark");
    }
  }
  const toggleBodyColorPrimary = () => {
    const bsSheetEl = window.document.querySelector("link#quarto-bootstrap");
    if (bsSheetEl) {
      toggleBodyColorMode(bsSheetEl);
    }
  }
  toggleBodyColorPrimary();  
  const icon = "";
  const anchorJS = new window.AnchorJS();
  anchorJS.options = {
    placement: 'right',
    icon: icon
  };
  anchorJS.add('.anchored');
  const isCodeAnnotation = (el) => {
    for (const clz of el.classList) {
      if (clz.startsWith('code-annotation-')) {                     
        return true;
      }
    }
    return false;
  }
  const clipboard = new window.ClipboardJS('.code-copy-button', {
    text: function(trigger) {
      const codeEl = trigger.previousElementSibling.cloneNode(true);
      for (const childEl of codeEl.children) {
        if (isCodeAnnotation(childEl)) {
          childEl.remove();
        }
      }
      return codeEl.innerText;
    }
  });
  clipboard.on('success', function(e) {
    // button target
    const button = e.trigger;
    // don't keep focus
    button.blur();
    // flash "checked"
    button.classList.add('code-copy-button-checked');
    var currentTitle = button.getAttribute("title");
    button.setAttribute("title", "Copied!");
    let tooltip;
    if (window.bootstrap) {
      button.setAttribute("data-bs-toggle", "tooltip");
      button.setAttribute("data-bs-placement", "left");
      button.setAttribute("data-bs-title", "Copied!");
      tooltip = new bootstrap.Tooltip(button, 
        { trigger: "manual", 
          customClass: "code-copy-button-tooltip",
          offset: [0, -8]});
      tooltip.show();    
    }
    setTimeout(function() {
      if (tooltip) {
        tooltip.hide();
        button.removeAttribute("data-bs-title");
        button.removeAttribute("data-bs-toggle");
        button.removeAttribute("data-bs-placement");
      }
      button.setAttribute("title", currentTitle);
      button.classList.remove('code-copy-button-checked');
    }, 1000);
    // clear code selection
    e.clearSelection();
  });
    var localhostRegex = new RegExp(/^(?:http|https):\/\/localhost\:?[0-9]*\//);
    var mailtoRegex = new RegExp(/^mailto:/);
      var filterRegex = new RegExp("https:\/\/AleMorales\.github\.io\/EcologicalModelsLabs\/");
    var isInternal = (href) => {
        return filterRegex.test(href) || localhostRegex.test(href) || mailtoRegex.test(href);
    }
    // Inspect non-navigation links and adorn them if external
 	var links = window.document.querySelectorAll('a[href]:not(.nav-link):not(.navbar-brand):not(.toc-action):not(.sidebar-link):not(.sidebar-item-toggle):not(.pagination-link):not(.no-external):not([aria-hidden]):not(.dropdown-item):not(.quarto-navigation-tool)');
    for (var i=0; i<links.length; i++) {
      const link = links[i];
      if (!isInternal(link.href)) {
        // undo the damage that might have been done by quarto-nav.js in the case of
        // links that we want to consider external
        if (link.dataset.originalHref !== undefined) {
          link.href = link.dataset.originalHref;
        }
      }
    }
  function tippyHover(el, contentFn, onTriggerFn, onUntriggerFn) {
    const config = {
      allowHTML: true,
      maxWidth: 500,
      delay: 100,
      arrow: false,
      appendTo: function(el) {
          return el.parentElement;
      },
      interactive: true,
      interactiveBorder: 10,
      theme: 'quarto',
      placement: 'bottom-start',
    };
    if (contentFn) {
      config.content = contentFn;
    }
    if (onTriggerFn) {
      config.onTrigger = onTriggerFn;
    }
    if (onUntriggerFn) {
      config.onUntrigger = onUntriggerFn;
    }
    window.tippy(el, config); 
  }
  const noterefs = window.document.querySelectorAll('a[role="doc-noteref"]');
  for (var i=0; i<noterefs.length; i++) {
    const ref = noterefs[i];
    tippyHover(ref, function() {
      // use id or data attribute instead here
      let href = ref.getAttribute('data-footnote-href') || ref.getAttribute('href');
      try { href = new URL(href).hash; } catch {}
      const id = href.replace(/^#\/?/, "");
      const note = window.document.getElementById(id);
      if (note) {
        return note.innerHTML;
      } else {
        return "";
      }
    });
  }
  const xrefs = window.document.querySelectorAll('a.quarto-xref');
  const processXRef = (id, note) => {
    // Strip column container classes
    const stripColumnClz = (el) => {
      el.classList.remove("page-full", "page-columns");
      if (el.children) {
        for (const child of el.children) {
          stripColumnClz(child);
        }
      }
    }
    stripColumnClz(note)
    if (id === null || id.startsWith('sec-')) {
      // Special case sections, only their first couple elements
      const container = document.createElement("div");
      if (note.children && note.children.length > 2) {
        container.appendChild(note.children[0].cloneNode(true));
        for (let i = 1; i < note.children.length; i++) {
          const child = note.children[i];
          if (child.tagName === "P" && child.innerText === "") {
            continue;
          } else {
            container.appendChild(child.cloneNode(true));
            break;
          }
        }
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(container);
        }
        return container.innerHTML
      } else {
        if (window.Quarto?.typesetMath) {
          window.Quarto.typesetMath(note);
        }
        return note.innerHTML;
      }
    } else {
      // Remove any anchor links if they are present
      const anchorLink = note.querySelector('a.anchorjs-link');
      if (anchorLink) {
        anchorLink.remove();
      }
      if (window.Quarto?.typesetMath) {
        window.Quarto.typesetMath(note);
      }
      // TODO in 1.5, we should make sure this works without a callout special case
      if (note.classList.contains("callout")) {
        return note.outerHTML;
      } else {
        return note.innerHTML;
      }
    }
  }
  for (var i=0; i<xrefs.length; i++) {
    const xref = xrefs[i];
    tippyHover(xref, undefined, function(instance) {
      instance.disable();
      let url = xref.getAttribute('href');
      let hash = undefined; 
      if (url.startsWith('#')) {
        hash = url;
      } else {
        try { hash = new URL(url).hash; } catch {}
      }
      if (hash) {
        const id = hash.replace(/^#\/?/, "");
        const note = window.document.getElementById(id);
        if (note !== null) {
          try {
            const html = processXRef(id, note.cloneNode(true));
            instance.setContent(html);
          } finally {
            instance.enable();
            instance.show();
          }
        } else {
          // See if we can fetch this
          fetch(url.split('#')[0])
          .then(res => res.text())
          .then(html => {
            const parser = new DOMParser();
            const htmlDoc = parser.parseFromString(html, "text/html");
            const note = htmlDoc.getElementById(id);
            if (note !== null) {
              const html = processXRef(id, note);
              instance.setContent(html);
            } 
          }).finally(() => {
            instance.enable();
            instance.show();
          });
        }
      } else {
        // See if we can fetch a full url (with no hash to target)
        // This is a special case and we should probably do some content thinning / targeting
        fetch(url)
        .then(res => res.text())
        .then(html => {
          const parser = new DOMParser();
          const htmlDoc = parser.parseFromString(html, "text/html");
          const note = htmlDoc.querySelector('main.content');
          if (note !== null) {
            // This should only happen for chapter cross references
            // (since there is no id in the URL)
            // remove the first header
            if (note.children.length > 0 && note.children[0].tagName === "HEADER") {
              note.children[0].remove();
            }
            const html = processXRef(null, note);
            instance.setContent(html);
          } 
        }).finally(() => {
          instance.enable();
          instance.show();
        });
      }
    }, function(instance) {
    });
  }
      let selectedAnnoteEl;
      const selectorForAnnotation = ( cell, annotation) => {
        let cellAttr = 'data-code-cell="' + cell + '"';
        let lineAttr = 'data-code-annotation="' +  annotation + '"';
        const selector = 'span[' + cellAttr + '][' + lineAttr + ']';
        return selector;
      }
      const selectCodeLines = (annoteEl) => {
        const doc = window.document;
        const targetCell = annoteEl.getAttribute("data-target-cell");
        const targetAnnotation = annoteEl.getAttribute("data-target-annotation");
        const annoteSpan = window.document.querySelector(selectorForAnnotation(targetCell, targetAnnotation));
        const lines = annoteSpan.getAttribute("data-code-lines").split(",");
        const lineIds = lines.map((line) => {
          return targetCell + "-" + line;
        })
        let top = null;
        let height = null;
        let parent = null;
        if (lineIds.length > 0) {
            //compute the position of the single el (top and bottom and make a div)
            const el = window.document.getElementById(lineIds[0]);
            top = el.offsetTop;
            height = el.offsetHeight;
            parent = el.parentElement.parentElement;
          if (lineIds.length > 1) {
            const lastEl = window.document.getElementById(lineIds[lineIds.length - 1]);
            const bottom = lastEl.offsetTop + lastEl.offsetHeight;
            height = bottom - top;
          }
          if (top !== null && height !== null && parent !== null) {
            // cook up a div (if necessary) and position it 
            let div = window.document.getElementById("code-annotation-line-highlight");
            if (div === null) {
              div = window.document.createElement("div");
              div.setAttribute("id", "code-annotation-line-highlight");
              div.style.position = 'absolute';
              parent.appendChild(div);
            }
            div.style.top = top - 2 + "px";
            div.style.height = height + 4 + "px";
            div.style.left = 0;
            let gutterDiv = window.document.getElementById("code-annotation-line-highlight-gutter");
            if (gutterDiv === null) {
              gutterDiv = window.document.createElement("div");
              gutterDiv.setAttribute("id", "code-annotation-line-highlight-gutter");
              gutterDiv.style.position = 'absolute';
              const codeCell = window.document.getElementById(targetCell);
              const gutter = codeCell.querySelector('.code-annotation-gutter');
              gutter.appendChild(gutterDiv);
            }
            gutterDiv.style.top = top - 2 + "px";
            gutterDiv.style.height = height + 4 + "px";
          }
          selectedAnnoteEl = annoteEl;
        }
      };
      const unselectCodeLines = () => {
        const elementsIds = ["code-annotation-line-highlight", "code-annotation-line-highlight-gutter"];
        elementsIds.forEach((elId) => {
          const div = window.document.getElementById(elId);
          if (div) {
            div.remove();
          }
        });
        selectedAnnoteEl = undefined;
      };
        // Handle positioning of the toggle
    window.addEventListener(
      "resize",
      throttle(() => {
        elRect = undefined;
        if (selectedAnnoteEl) {
          selectCodeLines(selectedAnnoteEl);
        }
      }, 10)
    );
    function throttle(fn, ms) {
    let throttle = false;
    let timer;
      return (...args) => {
        if(!throttle) { // first call gets through
            fn.apply(this, args);
            throttle = true;
        } else { // all the others get throttled
            if(timer) clearTimeout(timer); // cancel #2
            timer = setTimeout(() => {
              fn.apply(this, args);
              timer = throttle = false;
            }, ms);
        }
      };
    }
      // Attach click handler to the DT
      const annoteDls = window.document.querySelectorAll('dt[data-target-cell]');
      for (const annoteDlNode of annoteDls) {
        annoteDlNode.addEventListener('click', (event) => {
          const clickedEl = event.target;
          if (clickedEl !== selectedAnnoteEl) {
            unselectCodeLines();
            const activeEl = window.document.querySelector('dt[data-target-cell].code-annotation-active');
            if (activeEl) {
              activeEl.classList.remove('code-annotation-active');
            }
            selectCodeLines(clickedEl);
            clickedEl.classList.add('code-annotation-active');
          } else {
            // Unselect the line
            unselectCodeLines();
            clickedEl.classList.remove('code-annotation-active');
          }
        });
      }
  const findCites = (el) => {
    const parentEl = el.parentElement;
    if (parentEl) {
      const cites = parentEl.dataset.cites;
      if (cites) {
        return {
          el,
          cites: cites.split(' ')
        };
      } else {
        return findCites(el.parentElement)
      }
    } else {
      return undefined;
    }
  };
  var bibliorefs = window.document.querySelectorAll('a[role="doc-biblioref"]');
  for (var i=0; i<bibliorefs.length; i++) {
    const ref = bibliorefs[i];
    const citeInfo = findCites(ref);
    if (citeInfo) {
      tippyHover(citeInfo.el, function() {
        var popup = window.document.createElement('div');
        citeInfo.cites.forEach(function(cite) {
          var citeDiv = window.document.createElement('div');
          citeDiv.classList.add('hanging-indent');
          citeDiv.classList.add('csl-entry');
          var biblioDiv = window.document.getElementById('ref-' + cite);
          if (biblioDiv) {
            citeDiv.innerHTML = biblioDiv.innerHTML;
          }
          popup.appendChild(citeDiv);
        });
        return popup.innerHTML;
      });
    }
  }
});
</script>
</div> <!-- /content -->




</body></html>